<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <style type="text/css" media="all">
        .tweet {
            background-color: #fff;
            border-radius: 3px;
            padding: 10px;
            margin-bottom: 10px;
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.15);
        }

        body {
            background-color: #eee;
            color: #666666;
        }
    </style>
  </head>
  <body>
    <script>
        var refreshTweets = function () {
            displayTweets(getNewTweets());
        };

        var displayTweets = function (tweets) {
            tweets.forEach(displayTweet);
        };

        var displayTweet = function (tweet) {
            $('<div>').text('@' + tweet.user + ': ' + tweet.message)
                .addClass('tweet')
                .prependTo($('body'));
        };

        var getNewTweets = function () {
            var result = streams.home.slice();
            archive(streams.home); // Clear tweet stream, but don't delete old tweets.
            return result;
        };

        var archive = function (array_to_archive) {
            streams.home.splice(0, streams.home.length).forEach(function (tweet) {
                    streams.archive.push(tweet);
            });
        };

        var setup = function () {
            streams.archive = [];
        };

        $(document).ready(function () {
            $('body').html('');
            setInterval(refreshTweets, 500);
            setup();
        });
    </script>
  </body>
</html>
